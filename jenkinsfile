pipeline {
    agent any
    tools {
        maven 'Maven 3.5.2'
        jdk 'Java 9'
    }
    stages {
        stage ('Initialize') {
            steps {
                bat 'set'
            }
        }

        stage ('Build') {
            steps {
               script {
                   def fields = env.getEnvironment()
                   fields.each {
                        key, value -> println("${key} = ${value}");
                    }
                    println(env.BRANCH_NAME)
               }
                
            }

            
        }

        stage ('Deploy to Octopus') {
            steps {
                // withCredentials([string(credentialsId: 'OctopusAPIKey', variable: 'APIKey')]) {
                    bat '''
                        "Octo.exe" push --server http://cat-build:8083 --apiKey API-S17GGX3TBI3CFO0MKDEPK56F2NY --package targets/archive.3.1.4.zip
                        "Octo.exe" create-release --server http://cat-build:8083 --apiKey API-S17GGX3TBI3CFO0MKDEPK56F2NY --package archive.3.1.4.zip:%BUILD_NUMBER% --channel %BRANCH_NAME% --project poc-to-be-deleted
                    '''
                    // push --server http://localhost:8083 --apiKey API-S17GGX3TBI3CFO0MKDEPK56F2NY --package DB\artifacts\applicationformv2-feature3-db.2.0.1.%BUILD_NUMBER%.zip --package artifacts\applicationformv2-feature3-ui.2.0.1.%BUILD_NUMBER%.zip
                    // "C:\Octopus\Tools\OctopusTools.4.41.2\Octo.exe" push --server http://localhost:8083 --apiKey API-S17GGX3TBI3CFO0MKDEPK56F2NY --package DB\artifacts\applicationformv2-feature3-db.2.0.1.%BUILD_NUMBER%.zip --package artifacts\applicationformv2-feature3-ui.2.0.1.%BUILD_NUMBER%.zip

                    // sh """
                    //     ${tool('Octo CLI')}/Octo push --package target/demo.0.0.1-SNAPSHOT.war --replace-existing --server https://youroctopusserver --apiKey ${APIKey}
                    //     ${tool('Octo CLI')}/Octo create-release --project "Thymeleaf Demo" --server https://youroctopusserver --apiKey ${APIKey}
                    //     ${tool('Octo CLI')}/Octo deploy-release --project "Thymeleaf Demo" --version latest --deployto Integration --server https://youroctopusserver --apiKey ${APIKey}
                    // """
                // }
            }
        }
    }
}